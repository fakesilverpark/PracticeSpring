<html lang="kr">
<head>
    <meta charset="utf-8">
    <title>URL ë‹¨ì¶• ì„œë¹„ìŠ¤</title>
</head>
<body>
<h1>URL ë‹¨ì¶• ì„œë¹„ìŠ¤</h1>
<div>
    <form onsubmit="return makeShortenUrl();">
        <input type="url" id="originalUrl" placeholder="ë‹¨ì¶•í•  URLì„ ì…ë ¥í•˜ì„¸ìš”" size="50" required autofocus>
        <input type="submit" value="ë‹¨ì¶• URL ìƒì„±">
    </form>
    ë‹¨ì¶•ëœ URL : <span id="generatedUrl"></span>
</div>
<br>
<hr>
<br>
<h2>ë‹¨ì¶• URL ì •ë³´ ì¡°íšŒ</h2>
<div>
    <form onsubmit="return getShortenUrlInformation();">
        <input type="url" id="shortenUrl" placeholder="ì •ë³´ë¥¼ ì¡°íšŒí•  ë‹¨ì¶• URLì„ ì…ë ¥í•˜ì„¸ìš”" size="50" required>
        <input type="submit" value="ë‹¨ì¶• URL ì •ë³´ ì¡°íšŒ">
    </form>
    ë‹¨ì¶• URL ì •ë³´ : <span id="shortenUrlInformation"></span>
</div>
<script>
    function makeShortenUrl() {
        const originalUrl = document.querySelector('#originalUrl').value;
        const requestObject = {originalUrl: originalUrl};
        const requestJson = JSON.stringify(requestObject);

        function onReadyStateChange(event) {
            if (ajaxRequest.readyState === XMLHttpRequest.DONE) {
                if (ajaxRequest.status === 200) {
                    const shortenUrl = JSON.parse(ajaxRequest.responseText);
                    const completedShortenUrl = window.location.protocol + "//" + window.location.host + "/" +
                        shortenUrl.shortenUrlKey;

                    const generatedUrlDom = document.querySelector('#generatedUrl');
                    generatedUrlDom.innerHTML = completedShortenUrl;
                } else {
                    console.error('request failed');
                }
            }
        }

        const ajaxRequest = new XMLHttpRequest();

        ajaxRequest.onreadystatechange = onReadyStateChange;
        ajaxRequest.open('POST', '/shortenUrl');
        ajaxRequest.setRequestHeader('Content-Type', 'application/json');
        ajaxRequest.send(requestJson);

        return false;
    }

    function getShortenUrlInformation() {
        const shortenUrl = document.querySelector('#shortenUrl').value;
        const shortenUrlKey = shortenUrl.split("/").pop(); // ğŸ” ìˆ˜ì •ëœ ë¶€ë¶„

        console.log("Extracted Shorten URL Key:", shortenUrlKey); // ë””ë²„ê¹…ìš© ë¡œê·¸

        const ajaxRequest = new XMLHttpRequest();
        ajaxRequest.onreadystatechange = function () {
            if (ajaxRequest.readyState === XMLHttpRequest.DONE) {
                console.log("Response Status:", ajaxRequest.status);
                console.log("Response Text:", ajaxRequest.responseText);

                if (ajaxRequest.status === 200) {
                    document.querySelector('#shortenUrlInformation').innerText = ajaxRequest.responseText;
                } else {
                    console.error('Request failed', ajaxRequest.status, ajaxRequest.responseText);
                }
            }
        };

        console.log("Requesting URL:", `/shortenUrl/${shortenUrlKey}`); // ë””ë²„ê¹…ìš© ë¡œê·¸

        ajaxRequest.open('GET', `/shortenUrl/${shortenUrlKey}`);
        ajaxRequest.setRequestHeader('Accept', 'application/json');  // JSON ì‘ë‹µ ìš”êµ¬
        ajaxRequest.send();

        return false;
    }

</script>
</body>
</html>